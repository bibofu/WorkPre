## 第一章：网络基础知识

本章总结了深入理解TCP/IP 所必备的基础知识，其中包括计算机与网络发展的历史及其标准化过程、 OSI 参考模型、网络概念的本
质、网络构建的设备等。

![](https://pic.imgdb.cn/item/6218c1ff2ab3f51d91ff5a09.png)



### 计算机网络出现的背景

计算机网络，根据其规模可分为 WAN (Wide Area Network, 广域网）和LAN (Local Area Network, 局域网）。

![](https://pic.imgdb.cn/item/6218c2732ab3f51d91008225.png)



### 计算机与网络发展的7个阶段

#### 批处理

#### 分时系统

#### 计算机之间的通信

#### 计算机网络的产生

#### 互联网的普及

#### 以互联网技术为中心的时代

#### 从“单纯建立连接”到“安全建立连接”

![](https://pic.imgdb.cn/item/6218c3c02ab3f51d9103b47a.png)



#### 手握金刚钻的 TCP/IP

如前面所介绍，互联网是由许多独立发展的网络通信技术融合而成。能够使它们之间不断融合并实现统一的正是 TCP/IP 技术。那么 TCP/IP 的机制究竟又是如何呢？
TCP/IP 是通信协议的统称。在学习下一章 TCP/IP 核心机制之前，有必要先理清”协议”的概念。

![](https://pic.imgdb.cn/item/6218c41e2ab3f51d91048ca6.png)



### 协议

#### 随处可见的协议

在计算机网络与信息通信领域里，人们经常提及“协议”一词。互联网中常用的具有代表性的协议有 IP TCP HTTP 等。而 LAN (局域网）中常用的协议IPX/SP灯等。
"计算机网络体系结构" 将这些网络协议进行了系统的归纳。==TCP/IP 就是IP TCP HTIP 等协议的集合==。现在，很多设备都支持 TCP/IP 。

#### 协议的必要性

#### 协议如同人与人的对话

#### 计算机中的协议

![](https://pic.imgdb.cn/item/6218c5732ab3f51d9107cb93.png)



#### 分组交换协议

分组交换是指将大数据分割为一个个叫做包 (Packet) 的较小单位进行传输的方法。这里所说的包，如同我们平常在邮局里见到的邮包。分组交换就是将大数据分装为一个个这样的邮包交给对方。

![](https://pic.imgdb.cn/item/6218cdda2ab3f51d911c66e5.png)



### 协议由谁规定



### 协议分层与 OSI 参考模型

#### 协议的分层

协议分层就如同计算机软件中的模块化开发。 OSI 参考模型的建议是比较理想化的。它希望实现从第一层到第七层的所有模块，并将它们组合起来实现网络通信。分层可以将每个分层独立使用，即使系统中某些分层发生变化，也不会波及整个系统。因此，可以构造一个扩展性和灵活性都较强的系统。此外，通过分层能够细分通信功能，更易千单独实现每个分层的协议，并界定各个分层的具体责任和义务。这些都属于分层的优点。
而分层的劣势，可能就在于过分模块化、使处理变得更加沉重以及每个模块都不得不实现相似的处理逻辑等问题。

![](https://pic.imgdb.cn/item/6218ce8c2ab3f51d911e289b.png)

#### 通过对话理解分层

#### OSI 参考模型

![](https://pic.imgdb.cn/item/6218cf062ab3f51d911f56a3.png)



#### OSI 参考模型中各个分层的作用

![](https://pic.imgdb.cn/item/6218cfd42ab3f51d912160a7.png)



#### OSI 参考模型通信处理举例

### 传输方式的分类

#### 面向有连接型与面向无连接型

面向无连接型包括以太网、IP UDP 等协议。面向有连接型包括 ATM 、帧中继、 TCP协议。

![](https://pic.imgdb.cn/item/6218d1472ab3f51d9124f15e.png)



#### 电路交换与分组交换

#### 根据接收端数量分类

网络通信当中，也可以根据目标地址的个数及其后续的行为对通信进行分类。如广播、多播等就是这种分类的产物。
==单播 (Unicast)==
字面上， "Uni" 表示 "1", "Cast" 意为＂投掷＂。组合起来就是指信。早先的固定电话就是单播通信的一个典型例子。
==广播 (Broadcast)==
字面上具有＂播放”之意。因此它指是将消息从 台主机发送给与之相连的所有其他主机。广播通信 的一个典型例子就是电视播放，它将电视信号一齐发送给非特定的多个接收对象。
此外，我们知道电视信号一般都有自己的频段。只有在相应频段的可接收范围内才能收到电视信号。与之类似，进行广播通信的计算机也有它们的广播范围。只有在这个范围之内的计算机才能收到相应的广播消息。这个范围叫做广播域。

![](https://pic.imgdb.cn/item/6218d2732ab3f51d9127eb18.png)





### 地址

为在实际的网络通信当中，每一层的协议所使用的地址都不尽相同。例如， TCP/IP 通信中使用 MAC 地址 (3. 2. 节）、 IP 地址
(4.2. 节）、端口号 (6. 节）等信息作为地址标识。甚至在应用层中，可以将电子邮件地址 (8. 4. 节）作为网络通信的地址。

#### 地址的唯一性

#### 地址的层次性



### 网络的构成要素

![](https://pic.imgdb.cn/item/6218d42d2ab3f51d912c83f0.png)



### 现代网络实态

![](https://pic.imgdb.cn/item/6218d4fd2ab3f51d912e6bda.png)





## 第二章：TCP/IP基础知识

TCP (Transmission Control Protocol) IP (Internet Protocol) 是互联网的众多通信协议中最为著名的。本章旨在介绍TCP/IP
的发展历程及其相关协议的概况。

![](https://pic.imgdb.cn/item/6218d5642ab3f51d912f663a.png)



### TCP/IP 出现的背景及其历史

### TCP/IP 的标准化

20 世纪 90 年代， ISO 开展了 OSI 这一国际标准协议的标准化进程。然而，OSI 协议并没有得到普及，真正被广泛使用的是 TCP/IP 协议。
究其原因，是由 TCP/IP 的标准化所致。 TCP/IP 的标准化中有其他协议的标准化没有的要求。这一点就是让 TCP/IP 更迅速地实现和普及的原动力。本节将介绍 TCP/IP 的标准化过程。



#### TCP/IP的具体含义

![](https://pic.imgdb.cn/item/6218d6002ab3f51d9130e36c.png)

#### TCP/IP 标准化精髓

#### TCP/IP 规范一RFC

#### TCP/IP 的标准化流程

#### RFC 的获取方法

### 互联网基础知识

### TCP/IP 协议分层模型

#### TCP/IP与OSI参考模型

![](https://pic.imgdb.cn/item/6218d7262ab3f51d9133b73b.png)

第1章我们介绍了 OSI 参考模型中各个分层的作用。 TCP/IP 诞生以来的各种协议其实也能对应到 OSI 参考模型当中。如果了解了这些协议分属 OSI 的哪一层，就能对该协议的目的有所了解。然后对于每个协议的具体技术要求就可以参考相应的规范了。
不难看出， TCP/IP与OSI 在分层模块上稍有区别。 OSI 参考模型注重通信协议必要的功能是什么..TCP/IP 则更强调”在计算机上实现协议应该开发哪种程序”。



#### 硬件（物理层）

TCP/IP 的最底层是负责数据传输的硬件。这种硬件就相当于以太网或电话线路等物理层的设备。关于它的内容一直无法统一定义。因为只要人们在物理层面上所使用的传输媒介不同（如使用网线或无线），网络的带宽、可靠性、安全性、延迟等都会有所不同，而在这些方面又没有一个既定的指标。总之， TCP/IP 是在网络互连的设备之间能够通信的前提下才被提出的协议。

#### 网络接口层（数据链路层）

网络接口层，，利用以太网中的数据链路层进行通信，因此属千接口层。也就是说，把它当做让 NIC 起作用的＂驱动程序”也无妨。驱动程序是在操作系统与硬件之间起桥梁作用的软件。计算机的外围附加设备或扩展卡，不是直接插到电脑上或电脑的扩展槽上就能马上使用的，还需要有相应驱动程序的支持。例如换了一个新的 NIC 网卡，不仅需要硬件，还需要软件才能真正投入使用。因此，人们常常还需要在操作系统的基础上安装一些驱动软件以便使用这些附加硬件



#### 互联网层（网络层）

互联网层使用 IP 协议，它相当于 OSI 模型中的第 层网络层。 IP 协议基于 IP地址转发分包数据。

![](https://pic.imgdb.cn/item/6218d8b92ab3f51d9137db14.png)

TCP/IP 分层中的互联网层与传输层的功能通常由操作系统提供。尤其是路由器，它必须得实现通过互联网层转发分组数据包的功能。
此外，连接互联网的所有主机跟路由器必须都实现 IP 的功能。其他连接互联网的网络设备（如网桥、中继器或集线器）就没必要一定实现 IP TCP功能



==IP协议==
IP 是跨越网络传送数据包，使整个互联网都能收到数据的协议。 IP 协议使数据能够发送到地球的另一端，这期间它使用 IP 地址作为主机的标识，IP 还隐含着数据链路层的功能。通过 IP, 相互通信的主机之间不论经过怎样的底层数据链路都能够实现通信。
虽然 IP 也是分组交换的一种协议，但是它不具有重发机制。即使分组数据包未能到达对端主机也不会重发。因此，属于非可靠性传输协议。

==ICMP协议==

IP 数据包在发送途中一旦发生异常导致无法到达对端目标地址时，需要给发送端发送一个发生异常的通知。 ICMP 就是为这一功能而制定的。它有时也被用来诊断网络的健康状况。

==ARP协议==

从分组数据包的 IP 地址中解析出物理地址 (MAC 地址）的一种协议。



#### 传输层

TCP/IP 的传输层有两个具有代表性的协议。该层的功能本身与 OSI 参考模型中的传输层类似。

![](https://pic.imgdb.cn/item/6218db252ab3f51d913e4219.png)

![](https://pic.imgdb.cn/item/6218db782ab3f51d913f29e1.png)



#### 应用层（会话层以上的分层）

TCP/IP 的分层中，将 OSI 参考模型中的会话层、表示层和应用层的功能都集中到了应用程序中实现。这些功能有时由一个单一的程序实现，有时也可能会由多个程序实现。因此，细看 TCP/IP 的应用程序功能会发现，它不仅实现 OSI 模型中应用层的内容，还要实现会话层与表示层的功能。

HTTP FTP TELNET SSH SNMP



### TCP/IP 分层模型与通信示例

TCP/IP 是如何在媒介上进行传输的呢？本节将介绍使用 TCP/IP 时，从应用层到物理媒介为止数据处理的流程。

#### 数据包首部

![](https://pic.imgdb.cn/item/6218dca12ab3f51d914241d6.png)

每个分层中，都会对所发送的数据附加一个首部，在这个首部中包含了该层必要的信息，如发送的目标地址以及协议相关信息。通常，为协议提供的信息为包首部，所要发送的内容为数据。如图 , 在下一层的角度看，从上一分层收到的包全部都被认为是本层的数据。

>   包、帧、数据报、段、消息
>   以上五个述语都用来表述数据的单位，大致区分如下：包可以说是全能性述语。帧用于表示数据链路层中包的单位。而数
>   据包是 IP和UDP 等网络层以上的分层中包的单位。段则表示 TCP 数据流中的信息。最后，消息是指应用协议中数据的单位。

>   包首部就像是协议的脸
>   网络中传输的数据包由两部分组成：一部分是协议所要用到的首部，另一部分是上层传过来的数据。首部的结构由协议的具体规范详细定义。
>   例如，识别上一层协议的域应该从包的哪一位开始取多少个比特、如何计算校验和并插入包的哪一位等。相互通信的两端计算机如果在识别协议的序号以及校验和的计算方法上不一样，就根本无法实现通信。因此，在数据包的首部，明确标明了协议应该如何读取数据。反过来说，看到首部，也就能够了解该协议必要的信息以及所要处理内容。因此，看到包首部就如同看到协议的规范。难怪有人会说首部就像是协议的脸了。

#### 发送数据包

假设甲给乙发送电子邮件，内容为：“早上好”。而从 TCP/IP 通信上看，是A从一台计算机 向另一台计算机B发送电子邮件。我们就通过这个例子来讲解一下TCP/IP 通信的过程。

##### 应用程序处理

启动应用程序新建邮件，将收件人邮箱填好，再由键盘输入邮件内容“早上好＂，鼠标点击“发送”按钮就可以开始 TCP/IP 的通信了。
首先，应用程序中会进行编码处理。例如，日文电子邮件使用 ISO- 2022-JP UTF-8 进行编码。这些编码相当千 OSI 的表示层功能。
编码转化后，实际邮件不一定会马上被发送出去，因为有些邮件的软件有一次同时发送多个邮件的功能，也可能会有用户点击“收信”按钮以后才一并接收新邮件的功能。像这种何时建立通信连接何时发送数据的管理功能，从某种宽泛的意义上看属于 OSI 参考模型中会话层的功能。应用在发送邮件的那一刻建立 TCP 连接，从而利用这个 TCP 连接发送数据。它的过程首先是将应用的数据发送给下一层的 TCP, 再做实际的转发处理。

##### TCP 模块的处理

为了实现 TCP 的这一功能，需要在应用层数据的前端附加一个 TCP 首部。TCP 首部中包括源端口号和目标端口号（用以识别发送主机跟接收主机上的应用）、序号（用以发送的包中哪部分是数据）以及校验和,(用以判断数据是否损坏）。随后将附加了 TCP 首部的包再发送给 IP

##### IP 模块的处理

IP TCP 传过来的 TCP 首部和 TCP 数据合起来当做自己的数据，并在 TCP首部的前端在加上自己的 IP 首部。因此， IP 数据包中 IP 首部后面紧跟着 TCP部，然后才是应用的数据首部和数据本身。 IP 首部中包含接收端 IP 地址以及发送IP 地址。紧随 IP 首部的还有用来判断其后面数据是 TCP 还是 UDP 的信息。
IP 包生成后，参考路由控制表决定接受此 IP 包的路由或主机。随后， IP将被发送给连接这些路由器或主机网络接口的驱动程序，以实现真正发送数据。如果尚不知道接收端的 MAC 地址，可以利用 ARP (Address Resolution Protocol) 查找。只要知道了对端的 MAC 地址，就可以将 MAC 地址和 IP 地址交给以太网的驱动程序，实现数据传输。



##### 网络接口（以太网驱动）的处理

从IP 传过来的 IP 包，对于以太网驱动来说不过就是数据。给这数据附加上以太网首部并进行发送处理。以太网首部中包含接收端 MAC 地址、发送端 MAC地址以及标志以太网类型的以太网数据的协议。根据上述信息产生的以太网数据包将通过物理层传输给接收端。发送处理中的 FCST 由硬件计算，添加到包的最后。设置 FCS 的目的是为了判断数据包是否由于噪声而被破坏。

![](https://pic.imgdb.cn/item/6219eb182ab3f51d91256df8.png)





#### 经过数据链路的包

经过每个协议分层时，都必须有识别包发送端和接收端的信息。以太网会用 MAC 地址， IP 会用 IP 地址，而 TCP/UDP 则会用端口号作为识别两端主机的地址。即使是在应用程序中，像电子邮件地址这样的信息也是一种地址标识。这些地址信息都在每个包经由各个分层时，附加到协议对应的包首部里边。

![](https://pic.imgdb.cn/item/6219ebe92ab3f51d91277780.png)



此外，每个分层的包首部中还包含一个识别位，它是用来标识上一层协议的种类信息。例如以太网的包首部中的以太网类型， IP 中的协议类型以及 TCP/UDP中两个端口的端口号等都起着识别协议类型的作用。就是在应用的首部信息中，有时也会包含一个用来识别其数据类型的标签。



#### 数据包接收处理

包的接收流程是发送流程的逆序过程。

##### 网络接口（以太网驱动）的处理

主机收到以太网包以后，首先从以太网的包首部找到 MAC 地址判断是否为发给自己的包。如果不是发给自己的包则丢弃数据
而如果接收到了恰好是发给自己的包，就查找以太网包首部中的类型域从而确定以太网协议所传送过来的数据类型。在这个例子中数据类型显然是 IP 包，因此再将数据传给处理 IP 的子程序，如果这时不是 IP 而是其他诸如 ARP 的协议，就把数据传给 ARP 处理。总之，如果以太网包首部的类型域包含了一个无法识别的协议类型，则丢弃数据。



##### IP 模块的处理

IP 模块收到 IP 包首部及后面的数据部分以后，也做类似的处理。如果判断得出包首部中的 IP 地址与自己的 IP 地址匹配，则可接收数据并从中查找上一层的协议。如果上一层是 TCP 就将 IP 包首部之后的部分传给 TCP 处理；如果是 UDP则将 IP 包首部后面的部分传给 UDP 处理。对于有路由祥的情况下，接收端地址往往不是自己的地址，此时，需要借助路由控制表，在调查应该送达的主机或路由器以后再转发数据。



##### TCP 模块的处理

在TCP 模块中，首先会计算一下校验和，判断数据是否被破坏。然后检查是否在按照序号接收数据。最后检查端口号，确定具体的应用程序。数据接收完毕后，接收端则发送一个“确认回执＂给发送端。如果这个回执信息未能达到发送端，那么发送端会认为接收端没有接收到数据而一直反复发送。数据被完整地接收以后，会传给由端口号识别的应用程序。



##### 应用程序的处理

接收端应用程序会直接接收发送端发送的数据。通过解析数据可以获知邮件的收件人地址是乙的地址。如果主机 上没有乙的邮件信箱，那么主机 返回给发送端一个“无此收件地址”的报错信息。
但在这个例子中，主机 上恰好有乙的收件箱，所以主机 和收件人乙能够收到电子邮件的正文。邮件会被保存到本机的硬盘上。如果保存也能正常进行，那么接收端会返回一个“处理正常＂的回执给发送端。反之，一旦出现磁盘满、邮件未能成功保存等问题，就会发送一个“处理异常＂的回执给发送端。
由此，用户乙就可以利用主机 上的邮件客户端，接收并阅读由主机A上的用户甲所发送过来的电子邮件一“早上好”。





## 第三章：数据链路

本章主要介绍计算机网络最基本的内容一一数据链路层。如果没有数据链路层，基千TCP/IP 的通信也就无从谈起。因此，本章将
着重介绍TCP/IP 的具体数据链路，如以太网、无线局域网、 PPP 等

### 数据链路的作用

本章旨在介绍 OSI 参考模型中数据链路层的相关技术，包括 MAC 寻址（物理寻址）、介质共享、非公有网络、分组交换、环路检测、 VLAN (Virtual Local Area Network, 虚拟局域网）等。本章也会涉及作为传输方式的数据链路，如以太网、WLAN (Wireless Local Area Network, 无限局域网）、 PPP (Point to Point Protocol, 点对点协议）等概念。数据链路也可以被视为网络传输中的最小单位。其实，仔
细观察连通全世界的互联网就可以发现，它也不外乎是由众多这样的数据链路组成的，因此又可以称互联网为“数据链路的集合”。

![](https://pic.imgdb.cn/item/621dccfd2ab3f51d912f0d60.png)



![](https://pic.imgdb.cn/item/621dcd7a2ab3f51d91300679.png)

### 数据链路相关技术

#### MAC 地址

![](https://pic.imgdb.cn/item/621dce1a2ab3f51d9131321a.png)



![](https://pic.imgdb.cn/item/621dd8672ab3f51d9145324c.png)



![](https://pic.imgdb.cn/item/621dd93a2ab3f51d9146bfcf.png)